const { ContextMenuInteraction } = require('discord.js');
const mongo = require('../../../mongo');
const path = require('path');
const countingSchema = require('../../../schemas/counting_game/counting_schema');

module.exports = {
    name: `test`,
    description: `dummy command for testing stuff`,
    permission: `MANAGE_MESSAGES`,
    cooldown: 30,
    type: `CHAT_INPUT`,
    /**
     * 
     * @param {ContextMenuInteraction} interaction 
     */
    async execute(interaction) {
        const { member, options } = interaction;

        await mongo().then(async mongoose => {

            const results = await countingSchema.find();

            for (const data of results) {
                const { userId, saves } = data

                if (!saves) {
                    await countingSchema.findOneAndUpdate({
                        userId
                    }, {
                        saves: 0
                    }, {
                        upsert: true
                    })
                }


            }
        })

        await interaction.reply({ content: `done`, ephemeral: true }).catch(err => console.error(`${path.basename(__filename)} There was a problem deferring an interaction: `, err));
    }
}